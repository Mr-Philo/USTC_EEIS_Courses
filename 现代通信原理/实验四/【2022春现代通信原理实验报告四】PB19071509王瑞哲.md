# 2021春现代通信原理第四次实验报告

### ——**数字频带传输的调制与解调**

​																																	PB19071509  王瑞哲



## >>>实验目的

- 掌握数字频带传输系统调制解调的仿真过程
- 掌握数字频带传输系统误码率仿真分析方法



## >>>实验原理

#### 一、带通信号的调制

数字频带信号通常也称为数字调制信号，**其信号频谱通常是带通型的**，适合于在带通型信道中传输。数字调制是将基带数字信号变换成适合带通型信道传输的一种信号处理方式，正如模拟通信一样，可以通过对基带信号的频谱搬移来适应信道特性，也可以采用频率调制、相位调制的方式来达到同样的目的。

根据调制方式的不同，可以将调制过程分为以下几种形式（均以二进制举例）：

- **2ASK调制**

  将二进制码元 “0” 对应信号 0，“1” 对应信号$A\cos2\pi f_ct$，则 2ASK 信号可以写成如下表达式：
  $$
  s_T(t)=\bigg[\sum_na_ng(t-nT_s)\bigg]A\cos2\pi f_ct
  $$
  其中$a_n\in\{0,1\}$，$g(t)=\bigg\{ \begin{array}{c}1, \quad 0\le t\le T_s \\0, \quad 其他 \end{array}$

  2ASK信号的功率谱密度为：$P_s(f)=\frac{A^2}{4}[P_m(f-f_c)+P_m(f+f_c)]$

- **2FSK调制**

  将二进制码元 “0” 对应信号 $A\cos2\pi f_1t$，“1” 对应信号$A\cos2\pi f_2t$，则 2FSK 信号可以写成如下表达式：
  $$
  s_T(t)=\sum_n\bar{a}_ng(t-nT_s)A(\cos2\pi f_1t+\varphi_n)+\sum_na_ng(t-nT_s)A(\cos2\pi f_2t+\varphi_n)
  $$
  2FSK 信号也可以看成是两个不同载波的 2ASK 信号的叠加：
  $$
  s_T(t)=s_1(t)cos(\cos2\pi f_1t+\varphi_1)+s_2(t)cos(\cos2\pi f_2t+\varphi_2)
  $$
  当这两项不相关时（如载波之间频率差足够大），它的功率谱密度为：
  $$
  P_s(f)=\frac{1}{4}[P_{s1}(f-f_1)+P_{s1}(f+f_1)]+\frac{1}{4}[P_{s2}(f-f_2)+P_{s2}(f+f_2)]
  $$

- **2PSK调制**

  将二进制码元 “0” 对应相位为$\pi$的载波$-A\cos2\pi f_ct$，“1” 对应相位为0的$A\cos2\pi f_ct$，则 2PSK 信号可以写成如下表达式：
  $$
  s_T(t)=\bigg[\sum_na_ng(t-nT_s)\bigg]A\cos2\pi f_ct
  $$
  其中$a_n\in\{-1,1\}$，$g(t)=\bigg\{ \begin{array}{c}1, \quad 0\le t\le T_s \\0, \quad 其他 \end{array}$

  2PSK信号的功率谱密度为：$P_s(f)=\frac{A^2}{4}[P_m(f-f_c)+P_m(f+f_c)]$



#### 二、**带通信号的解调**

解调是从携带消息的已调信号中恢复消息的过程。在数字系统中，解调过程中重要的一点是**根据接收信号判决出原信号的码元序列值**。由于信道噪声的存在，判决输出的码元序列会与原始传输的码元序列有一定误差。据此，**我们采用误码率来衡量一个传输系统的传输性能好坏**。

根据解调方法的不同，解调过程主要分为相干解调和非相干解调两种。对应的接收机结构称为相干接收机或非相干接收机。假定信道为加性高斯白噪声，以2ASK信号为例，二元判决问题为：
$$
\begin{array}{l}
H_0:x(t)=s_0(t)+n(t)=n(t)\\
H_1:x(t)=s_1(t)+n(t)=\bigg[\sum_na_ng(t-nT_s)\bigg]A\cos2\pi f_ct+n(t)
\end{array}
$$
其中$n(t)$为零均值，功率谱密度$N_0/2$的高斯白噪声。采用相干解调时，输出端先乘上相干载波$\cos2\pi f_ct$，在经过低通滤波器$h(\tau)$（若要获得最佳接收性能，需要经过匹配滤波器），再进行采样判决。其中，根据高斯分布密度函数特点，可以推出判决门限为：
$$
V_T=\frac{m_1+m_2}{2}\qquad其中\Bigg\{\begin{array}{c}m_1=\int_{0}^{T}h(\tau)s_1(T-\tau)d\tau\\m_2=\int_{0}^{T}h(\tau)s_2(T-\tau)d\tau \end{array}
$$


#### 三、**二进制数字调制系统的性能比较**

采用匹配滤波器，可以证明各调制解调系统的性能（误比特率）如下表所示：

| 方式     | 相干ASK                      | 非相干ASK                             | 相干正交FSK                  | 非相干正交FSK                         | 相干BPSK                      | 差分相干2DPSK                        |
| -------- | ---------------------------- | ------------------------------------- | ---------------------------- | ------------------------------------- | ----------------------------- | ------------------------------------ |
| 误比特率 | $Q(\sqrt{\dfrac{E_b}{N_0}})$ | $\dfrac{1}{2}exp(-\dfrac{E_b}{4N_0})$ | $Q(\sqrt{\dfrac{E_b}{N_0}})$ | $\dfrac{1}{2}exp(-\dfrac{E_b}{2N_0})$ | $Q(\sqrt{\dfrac{2E_b}{N_0}})$ | $\dfrac{1}{2}exp(-\dfrac{E_b}{N_0})$ |



## >>>实验内容

##### 一、用 Matlab 产生独立等概的二进制信源，画出 2ASK / 2FSK / 2DPSK 调制解调中信号波形及其功率谱变化过程，并在不同信噪比下对其进行抗噪声性能分析

解：选取2ASK信号调制过程，编写matlab代码如下（逐段分析）：

```matlab
clear
% 系统仿真参数 
fc = 2;             % 载波频率(Hz) 
snr = 5;            % 高斯白噪声信噪比(dB) 
fs = 16;            % 系统采样率 
ts = 1/fs;          % 系统采样间隔 
N = 1000;           % 码元数 
Ts = 1;             % 码元宽度 
Baud = 1/Ts;        % 波特率 
t = 0:ts:N*Ts-ts; 
t = t.';            % 时域序列，由N个点(码元)构成，每个点(码元)之间间隔ts(即采样间隔) 
Lt = length(t); 
N_sample = Ts*fs ;  % 以码元宽度乘上采样率，表示一个码元内要采多少样值
```

上面这段代码为本次实验中通信仿真参数的设置。

```matlab
% 产生二进制信源 
B = randi(2,1,N)-1;         % 生成1×N维(0,1)序列
subplot(241); stairs((1:20), B(1:20));       % 画出调制信号波形，只看前十个周期 
axis([1,20,-1,2]); xlabel('码元周期T'); title('信源序列');
sym = [0;1]; 
A = sym(B+1);               % A为N×1维(0,1)序列（利用sym调制）
```

上面这段代码为模拟产生二进制信源。

```matlab
% 2ASK调制过程
% rectpulse(t,w)函数：产生幅度为t、宽度w的矩形脉冲信号。
S = rectpulse(A, N_sample); 
subplot(242); pwelch(S,[],[],[],fs,'centered');            % 功率谱
xlabel('Frequency (Hz)'); ylabel('Power (dB)'); title('信源序列功率谱');
X = S.*cos(2*pi*fc*t);      % 生成2ASK时域调制波形X
figure(1)
subplot(243); plot(t(1:20*fs), X(1:20*fs));       % 画出调制信号波形，只看前十个周期 
axis([1,20,-1.5,1.5]); xlabel('码元周期T'); ylabel('时域幅度'); title('2ASK时域调制波形');
% 绘制功率谱
subplot(244); pwelch(X,[],[],[],fs,'centered');            % 功率谱
% [pxx,f] = pwelch(x,window,noverlap,f,fs): returns the power spectral density (PSD) estimate
xlabel('Frequency (Hz)'); ylabel('Power (dB)'); title('2ASK频域功率谱');
```

上面这段代码为2ASK调制过程。其中，利用了`pwelch(x,window,noverlap,f,fs)`函数来绘制原信号和2ASK调制信号的功率谱。

```matlab
% 2ASK解调过程  信道加性高斯白噪声
snr = 10*log10((2*pi/N_sample*Baud)*10^(snr/10));      % 归一化为数字信噪比
X_N = Gnoisegen(X, snr);
subplot(245); plot(t(1:20*fs), X_N(1:20*fs));
axis([1,20,-1.5,1.5]); xlabel('码元周期T'); ylabel('时域幅度'); title('加高斯白噪声后调制波形');

% 同步解调
r = X_N.*cos(2*pi*fc*t);
subplot(246); plot(t(1:20*fs), r(1:20*fs));
axis([1,20,-1.5,1.5]); xlabel('码元周期T'); ylabel('时域幅度'); title('乘相干载波后波形');
```

上面这段代码为信道加噪与乘相干载波解调过程。需要注意的是，第一部分设置参数时设定的信噪比`snr`为模拟形式，在数字传输中应采用数字归一化信噪比`Eb/N0`，两者之间的关系为：
$$
\frac{E_b}{N_0}=\frac{S}{N}\frac{W}{R_b}
$$
其中，$W$为带宽，$R_b$为码率。本次实验中，原序列融合在N点方波中传输，即`S = rectpulse(A, N_sample);` ，时域的N点矩形脉冲（正负各N/2点）变换到频域为`sinc`函数，由sinc函数性质知其带宽为$\dfrac{2\pi}{N}$；码元速率即为第一部分设置参数时的`Baud = 1/Ts;` 而在代码中，还需考虑到分贝形式和数字形式的转换（10log10的关系）

```matlab
% 低通滤波器设计
wp = 2*pi*2*fc*0.5;                         % 通带截止烦率
ws = 2*pi*2*fc*0.9;                         % 阻带截止频率
Rp = 2; As = 10;                            % Rp是通带波纹，As是阻带衰诚
[N_f,wc] = buttord(wp,ws,Rp,As,'s');        % 计算巴特沃斯滤波器阶次和截止频率
[B_f,A_f] = butter(N_f,wc,'s');             % 频率变换法设计巴特沃斯低通滤波器
% 低通滤波
h = tf(B_f,A_f);                % 转换为时域传输函数
Sr = lsim(h,r,t);               % 系统h对由nst和t描述的输入信号的时域响应
subplot(247); plot(t(1:20*fs), Sr(1:20*fs));
axis([1,20,-1.5,1.5]); xlabel('码元周期T'); ylabel('时域幅度'); title('低通滤波后波形');
```

上面这段代码为低通滤波器设计及低通滤波过程。

```matlab
% 抽样判决
Br = zeros(1,N);
for i = 1:N
    Br(i) = Sr(i*fs) > 0.25;    % 抽样判决：ASK同步解调的判决门限为1/4。Br为解调后的序列。
end
subplot(248); stairs((1:20), Br(1:20));       % 画出解调信号波形，只看前十个周期 
axis([1,20,-1,2]); xlabel('码元周期T'); title('解码信源序列');
 
error_rate0 = mae(B-Br)        % 误码率
exp_error_rate0 = qfunc(sqrt(10^(snr/10)))
```

上面这段代码为抽样判决过程。考虑传输信号s(t)，如果是传输“1”码元，即$A\cos2\pi f_ct$，乘同步载波后变为$A\cos^22\pi f_ct=A(\dfrac{1}{2}+\dfrac{1}{2}cos4\pi f_ct)$，经低通滤波器滤去高频分量后为$\dfrac{A}{2}=\dfrac{1}{2}$（因为所设的A=1）。如果是传输“0”码元则为0，所以判决门限设为$V_T=\dfrac{m_1+m_2}{2}=\dfrac{1}{4}$

```matlab
% 探究不同snr对误比特率的影响：
M = 100;
error_rate = zeros(1,M);
exp_error_rate = zeros(1,M);
snr_list = -5:0.1:5-0.1;
for j = 1:M
    snr = snr_list(j);
    % X为ASK调制波形，没有变化
    X_N = Gnoisegen(X, 10*log10((2*pi/N_sample*Baud)*10^(snr/10)));  	% 加噪(归一化数字信噪比)
    r = X_N.*cos(2*pi*fc*t);        % 乘同步载波
    Sr = lsim(h,r,t);               % 低通滤波
    for i = 1:N
        Br(i) = Sr(i*fs) > 0.25;    % 抽样判决：ASK同步解调的判决门限为1/4
    end
    error_rate(j) = mae(B-Br);        % 误码率
    exp_error_rate(j) = qfunc(sqrt(10^(snr/10)));
end
figure(2)       % 绘制y轴对数型坐标，方便观察
semilogy(snr_list, error_rate,'r-'); hold on
semilogy(snr_list, exp_error_rate,'b-');
xlabel('信噪比/dB'); ylabel('误码率'); title('误码率随信噪比变化规律');
legend('测试信噪比','期望信噪比');
```

上面这段代码为绘制误码率随信噪比变化规律的图像。

其中，Gnoisegen.m 函数可实现对序列x按所规定的信噪比加入高斯白噪声，详细内容如下：

```matlab
function [y,noise] = Gnoisegen(x,snr)
% Gnoisegen函数是叠加高斯白噪声到信号x中
% [y,noise] = Gnoisegen(x,snr)
% x是原信号，snr是设置的信噪比，单位为dB
% y是叠加高斯白噪声后的带噪语音，noise是被叠加的噪声
    noise = randn(size(x));                             % 用randn函数产生高斯白噪声
    Nx = length(x);                                     % 求出信号x长
    signal_power = 1/Nx*sum(x.*x);                      % 求出信号的平均能量
    noise_power = 1/Nx*sum(noise.*noise);               % 求出噪声的能量
    noise_variance = signal_power / ( 10^(snr/10) );    % 计算出噪声设定的方差值
    noise = sqrt(noise_variance/noise_power)*noise;     % 按噪声的平均能量构成相应的白噪声
    y = x + noise;                                      % 构成带噪语音
end
```

运行结果如下所示：

![fig1](E:\2022春课程资料\现代通信原理\实验四\fig1.png)

探究误码率随信噪比变化规律的图像如下所示：

<img src="E:\2022春课程资料\现代通信原理\实验四\fig2.png" alt="fig2" style="zoom:50%;" />

由上图可以看出，所测试的传输过程，其误码率比期望的信噪比$Q(\sqrt{\dfrac{E_b}{N_0}})$要略高一些。这是因为，$Q(\sqrt{\dfrac{E_b}{N_0}})$是在采用匹配滤波器接收机的情况下所推导出的公式，而本次实验中采用的是一个简单的低通滤波器，所以可能性能会略差一些，不过两者相差不大，可以近似认为符合理论推导。



## >>>实验总结

通过本次实验，我进一步掌握了数字频带传输系统调制解调的仿真过程，学会了数字频带传输系统误码率仿真分析方法，同时利用matlab软件对这一过程进行实地的仿真实验

在本次实验中，通过对例程的理解，和自己对代码的增删改动，我掌握到了matlab中许多函数的用法。比如：

- `y = rectpulse(t,w)` ：产生幅度为t、宽度w的矩形脉冲信号。
- `[pxx,f] = pwelch(x,window,noverlap,f,fs)` ：返回输入序列x的功率谱密度。其中参数x为输入序列，window为频谱分析时所采用的窗函数（默认为矩形窗），noverlap为采样点重叠值（默认为0），f为功率谱密度图上的中心频率（默认为0），fs为频谱分析时所采用的采样频率（默认为1）
- `[N_f,wc] = buttord(wp,ws,Rp,As,'s')` ：计算巴特沃斯滤波器阶次和截止频率，wp为通带截止频率，ws为止带截止频率，Rp为通带波纹，As为止带衰减。返回值N_f为滤波器阶数，wc为滤波器截止频率；
- `[B_f,A_f] = butter(N_f,wc,'s')`： 频率变换法设计巴特沃斯低通滤波器，返回值B_f和A_f为所设计FIR滤波器系统函数的分母和分子；
- `y = qfunc(x)`：计算Q函数，其定义为$Q(x)=\int_{x}^{+\infin}\frac{1}{\sqrt{2\pi}}e^{-x^2/2}dx$
- `semilogy(x, y)`：绘制y轴为对数尺度的曲线图

在本次实验的基础上，更改调制信号定义和接收机的判决门限等，还可以进一步实现2FSK信号、BPSK信号等信号的调制解调系统模拟，同时探究误码率随信噪比的变化关系。
