# 2021春现代通信原理第三次实验报告

### ——**码间串扰与眼图**

​																																	PB19071509  王瑞哲



## >>>实验目的

- 掌握模拟生成基带调制信号的方法
- 掌握生成眼图的方法
- 掌握分析眼图的分析方法



## >>>实验原理

#### 一、基带信号传输时的码间串扰

码间串扰来源于系统传输总特性不理想，**导致前后码元的波形畸变、展宽**，并使前面波形出现很长的拖尾，蔓延到当前码元的抽样时刻上，**从而对当前码元的判决造成干扰**。

信道总是带限的，带限信道对通过的的脉冲波形进行拓展。当信道带宽远大于脉冲带宽时，脉冲的拓展很小，当信道带宽接近于信号的带宽时，拓展将会超过一个码元周期，造成信号脉冲的重叠，称为码间串扰。

由于数字信息序列是随机的，要想通过在接收滤波器输出的信号抽样信号中的各项相互抵消使码间串扰为0是不行的，这就需要**对基带传输系统的总传输特性h(t)的波形提出要求**。无码间串扰要求h(t)满足**Nyquist第一准则：**
$$
H_{eq}(\omega)=\sum_{i=-\infin}^{\infin}H(\omega+\frac{2\pi i}{T_s})=const,\quad\abs{\omega}\le\frac{\pi}{T_s}
$$
Nyquist证明：要使码元速率为Rs **baud**的信号不存在码间干扰，理论上所需的最小系统带宽为Rs/2 Hz。最小系统带宽成立的条件是系统传输函数H(f)是如下的矩形函数：h(t)=sinc(t/T)，称为理想Nyquist脉冲。但理想Nyquist脉冲物理上不可实现（时间无穷，频谱非常陡峭），一般会使用升余弦滤波器进行脉冲整形（具有奇对称升余弦过渡带）：
$$
H(f)=\left\{ 
\begin{array}{l l}
1,&\abs{f}<2W_0-W \\
\cos^2\bigg(\dfrac{\pi}{4}\dfrac{\abs{f}+W-2W_0}{W-W_0}\bigg),&2W_0-W<\abs{f}<W \\
0,&\abs{f}>W
\end{array}\right.
$$
其中$W_0=T/2$是最小Nyquist带宽，$W$为绝对带宽，$W-W_0$是超量带宽，滚降因子$r=(W-W_0)/W_0$。此时，系统所需带宽与码元速率$R_s$的关系式为$W=(1+r)R_s/2$，频带利用率为$\eta=R_s/W=2/(1+r)$ buad/Hz。

升余弦滤波器的系统传输函数及是与冲激响应如下图所示：

![fig1](E:\2022春课程资料\现代通信原理\实验三\fig1.png)



#### 二、**眼图**

在实际系统中，完全消除码间串扰是十分困难的，而码间串扰对误码率的影响目前尚无法找到数学上便于处理的统计规律，还不能进行准确计算。为了衡量基带传输系统的性能优劣，在实验室中，**通常用示波器观察接收信号波形的方法来分析码间串扰和噪声对系统性能的影响**，这就是眼图分析法。如果将**输入波形输入示波器的 Y 轴，并且当示波器的水平扫描周期和码元定时同步时**，在示波器上显示的图形很象人的眼睛，因此被称为眼图。

二进制信号传输时的眼图只有一只“眼睛”，当传输三元码时，会显示两只“眼睛”。**眼图是由各段码元波形叠加而成的**，眼图中央的垂直线表示**最佳抽样时刻**，位于两峰值中间的水平线是**判决门限电平**。在无码间串扰和噪声的理想情况下，波形无失真，“眼”开启得最大。当有码间串扰时，波形失真，引起“眼”部分闭合。若再加上噪声的影响，则使眼图的线条变得模糊，“眼”开启得小了，**因此，“眼”张开的大小表示了失真的程度**。由此可知，眼图能直观地表明码间串扰和噪声的影响，可评价一个基带传输系统性能的优劣。另外也可以用此图形对接收滤波器的特性加以调整，以减小码间串扰和改善系统的传输性能。

<img src="E:\2022春课程资料\现代通信原理\实验三\fig2.png" alt="fig2" style="zoom:80%;" />

通常眼图可以用上图所示的图形来描述。由此图可以看出：

1. **眼图张开的宽度**决定了接收波形可以不受串扰影响而抽样再生的时间间隔。显然，最佳抽样时刻应选在眼睛张开最大的时刻。
2. **眼图斜边的斜率**，表示系统对定时抖动（或误差）的灵敏度，斜边越陡，系统对定时抖动越敏感。
3.  **眼图左（右）角阴影部分的水平宽度**表示信号零点的变化范围，称为零点失真量，在许多接收设备中，定时信息是由信号零点位置来提取的，对于这种设备零点失真量很重要。
4. 在抽样时刻，阴影区的垂直宽度表示最大信号失真量。
5. 在抽样时刻上、下两阴影区间隔的一半是最小噪声容限，噪声瞬时值超过它就有可能发生错误判决；
6. 横轴对应判决门限电平。



## >>>实验内容

##### 一、分别产生符合下列要求的 BPSK 和 4ASK 调制波形的眼图，设符号率为 1Hz，要求调制波形经过升余弦滚降成形(缺省滚降系数为 0.5)：

1. ##### 无噪声和 20dB 加性高斯白噪声

2. ##### 升余弦滚降系数分别为 0.5 和 1

3. ##### 受到码间串扰影响，信道参数可设为：ch=[0.9806; -0.1961]

解：编写MATLAB代码如下所示：

```matlab
clear
Fs = 64;        % 采样频率 
Fd = 1;         % 符号率1Hz
N = 200;        % 码元序列长度
% 模拟生成N=200长的BPSK调制后的序列（即-1,1序列）
BPSK0 = 2*randi([0,1], N, 1) - 1;       % 生成N×1维度的随机1,-1序列（用随机0/2序列减1构造）
BPSKN0 = Gnoisegen(BPSK0,20);           % 加20dB高斯白噪声的模拟BPSK序列
BPSK = upsample(BPSK0, Fs/Fd);          % 按所设置的采样率对模拟BPSK序列上采样
BPSKN = upsample(BPSKN0, Fs/Fd); 

% 模拟生成N=200长的4ASK调制后的序列（即0,1,2,3序列）
ASK0 = randi([1,4], N, 1)-1;           	% 生成N×1维度的随机0,1,2,3序列
ASKN0 = Gnoisegen(ASK0,20);
ASK = upsample(ASK0, Fs/Fd);
ASKN = upsample(ASKN0, Fs/Fd);

H1 = rcosine(Fd, Fs, 'fir', 0.5);		% 滚降系数0.5的升余弦滤波器
H2 = rcosine(Fd, Fs, 'fir', 1);			% 滚降系数1的升余弦滤波器

ch = [0.9806; -0.1961];
ch = ch/norm(ch);       				% 模拟引入码间串扰信道

% BPSK: 无噪声，滚降系数0.5，无码间串扰
X1 = filter(H1, 1, BPSK);
% plot (X1(1:1280));           			% A(i:j): 取出矩阵A的第i~j个值操作（按列优先）
Y1 = X1(Fs*4+1:end-Fs*4);
eyediagram (Y1, Fs*2);       			% 创建y的眼图，每个轨迹包括2倍Fs的采样点
title('BPSK:no noise, a=0.5, no interference');

% BPSK: 20dB加性白噪声，滚降系数0.5，无码间串扰
X2 = filter(H1, 1, BPSKN);	
% plot (X2(1:1280));
Y2 = X2(Fs*4+1:end-Fs*4);
eyediagram (Y2, Fs*2); title('BPSK:20dB noise, a=0.5, no interference');

% BPSK: 无噪声，滚降系数1，无码间串扰
X3 = filter(H2, 1, BPSK);	
% plot (X3(1:1280));
Y3 = X3(Fs*4+1:end-Fs*4);
eyediagram (Y3, Fs*2); title('BPSK:no noise, a=1, no interference');

% BPSK: 无噪声，滚降系数1，有码间串扰
X4 = filter(ch, 1, X1);     % 在X1的基础上加入码间串扰后的序列
% plot (X4(1:1280));
Y4 = X4(Fs*4+1:end-Fs*4);
eyediagram (Y4, Fs*2); title('BPSK:no noise, a=0.5, interference');

% 4ASK: 无噪声，滚降系数0.5，无码间串扰
X5 = filter(H1, 1, ASK); 
% plot (X5(1:1280));
Y5 = X5(Fs*4+1:end-Fs*4);
eyediagram (Y5, Fs*2); title('4ASK:no noise, a=0.5, no interference');

% 4ASK: 20dB加性白噪声，滚降系数0.5，无码间串扰
X6 = filter(H1, 1, ASKN); 
% plot (X6(1:1280));
Y6 = X6(Fs*4+1:end-Fs*4);
eyediagram (Y6, Fs*2); title('4ASK:20dB noise, a=0.5, no interference');

% 4ASK: 无噪声，滚降系数1，无码间串扰
X7 = filter(H2, 1, ASK); 
% plot (X7(1:1280));
Y7 = X7(Fs*4+1:end-Fs*4);
eyediagram (Y7, Fs*2); title('4ASK:no noise, a=1, no interference');

% 4ASK: 无噪声，滚降系数0.5，有码间串扰
X8 = filter(ch, 1, X5); 
% plot (X8(1:1280));
Y8 = X8(Fs*4+1:end-Fs*4);
eyediagram (Y8, Fs*2); title('4ASK:no noise, a=0.5, interference');
```

其中，Gnoisegen.m 函数可实现对序列x按所规定的信噪比加入高斯白噪声，详细内容如下：

```matlab
function [y,noise] = Gnoisegen(x,snr)
% Gnoisegen函数是叠加高斯白噪声到信号x中
% [y,noise] = Gnoisegen(x,snr)
% x是原信号，snr是设置的信噪比，单位为dB
% y是叠加高斯白噪声后的带噪语音，noise是被叠加的噪声
    noise = randn(size(x));                             % 用randn函数产生高斯白噪声
    Nx = length(x);                                     % 求出信号x长
    signal_power = 1/Nx*sum(x.*x);                      % 求出信号的平均能量
    noise_power = 1/Nx*sum(noise.*noise);               % 求出噪声的能量
    noise_variance = signal_power / ( 10^(snr/10) );    % 计算出噪声设定的方差值
    noise = sqrt(noise_variance/noise_power)*noise;     % 按噪声的平均能量构成相应的白噪声
    y = x + noise;                                      % 构成带噪语音
end
```

对于BPSK信号和4ASK信号，运行结果分别如下所示：

<table frame=void>	<!--使用table标签，且frame=void消除外边框-->
	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye1.png"		
                     alt="错误"
					 /></center></td>	<!--<center>标签将图片居中-->
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye2.png"
                     alt="错误"
                     /></center></td>
    <tr>
    <td><center>无噪声，滚降系数0.5，无码间串扰</center></td>
    <td><center>20dB高斯白噪声，滚降系数0.5，无码间串扰</center></td>
    <tr>
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye3.png"		
                     alt="错误"
					 /></center></td>	<!--<center>标签将图片居中-->
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye4.png"
                     alt="错误"
                     /></center></td>    
    <tr>
    <td><center>无噪声，滚降系数1.0，无码间串扰</center></td>
    <td><center>无噪声，滚降系数0.5，有码间串扰</center></td>
    </tr>
</table>

<table frame=void>	<!--使用table标签，且frame=void消除外边框-->
	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye5.png"		
                     alt="错误"
					 /></center></td>	<!--<center>标签将图片居中-->
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye6.png"
                     alt="错误"
                     /></center></td>
    <tr>
    <td><center>无噪声，滚降系数0.5，无码间串扰</center></td>
    <td><center>20dB高斯白噪声，滚降系数0.5，无码间串扰</center></td>
    <tr>
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye7.png"		
                     alt="错误"
					 /></center></td>	<!--<center>标签将图片居中-->
    <td><center><img src="E:\2022春课程资料\现代通信原理\实验三\eye8.png"
                     alt="错误"
                     /></center></td>    
    <tr>
    <td><center>无噪声，滚降系数1.0，无码间串扰</center></td>
    <td><center>无噪声，滚降系数0.5，有码间串扰</center></td>
    </tr>
</table>



对比各眼图可以看出，各参数的变化对最终输出的眼图有些下面的影响：

1. **调制方法会影响眼图的形状**，实质上是信号进制数的影响：二进制信号传输时的眼图只有一只“眼睛”，三进制信号会显示两只“眼睛”，四进制则会显示三只“眼睛”，依此类推。本次实验中，BPSK信号为二进制信号，因此显示出一只眼睛；4ASK为四进制信号，则显示三只眼睛；
2. 对信号加噪声后，眼图中的线条会变得混乱，过零点畸变和抽样时刻最大信号畸变都会变大。眼图开启的程度衡量了失真的程度，加性高斯白噪声的引入必会对最终的判决输出产生干扰，**因此引入噪声必会使眼图开启的程度变小**；
3. 将升余弦滤波器的滚降系数由0.5改为1.0，参考实验原理部分的图像，相当于升余弦滤波器的频谱进一步展宽，则其时域波形的旁瓣降低。体现在眼图上可以观察到，**增大滚降系数，能够降低过零点畸变和最佳抽样时刻两侧时刻的最大信号畸变**。要注意这种时域畸变的减少是以牺牲频域带宽为代价的，减少了时域旁瓣峰值，频域的带宽必然会增加。滚降系数为$r$时，系统所需带宽与码元速率$R_s$的关系式为$W=(1+r)R_s/2$，频带利用率为$\eta=R_s/W=2/(1+r)$ buad/Hz。可见，r增加不会导致频带利用率降低，但可以改善眼图上的畸变情况；
4. **人为引入码间串扰信道，发现眼图的幅度值变小，即眼睛闭合程度减小**。这也反过来说明眼图的闭合程度确实与码间串扰程度有关。在代码中，码间串扰信道的实现方法为，使用ch = [0.9806; -0.1961]的信道与原信号卷积，相当于原始码序列中的每一个码值，乘上0.9806再和前一个码值乘上(-0.1961)相加得到新码值，由此在相邻码值间引入关系，即串扰。



## >>>实验总结

通过本次实验，我对于模拟生成调制信号、眼图的基本原理有了更深层次的理解，同时亲自动手实践了眼图的生成与绘制过程，并利用MATLAB实现并展示之。

在本次实验中，通过对例程的理解，我掌握到了matlab中许多函数的用法。比如：

- `y = upsample(x,n)` ：通过在样本之间插入n - 1个零来增加 x 的采样率。如果 x 是矩阵，则该函数将每一列视为单独的序列。
- `y = filter(B,A,X)` ：输入X为滤波前序列，Y为滤波结果序列，B/A 提供滤波器系数，B为分子， A为分母
- `H = rcosine(Fd, Fs, 'fir', 0.5)`：生成升余弦滚降滤波器函数。其中参数Fd为采样速率，Fs为符号率，'fir'为滤波器形状，0.5为滚降系数。返回值为FIR滤波器系数，正好可以作为filter函数中“分子”参数

在本次实验中还遇到了升余弦滤波器生成函数的问题。按matlab软件自身的定义，升余弦滤波器建议使用rcosdesign函数。`b = rcosdesign(beta, span, sps, shape)`函数的参数定义为，beta滚降因子，span为滤波器宽度（符号数），sps为每个符号的样本数（上采样因子），shape为升余弦窗的形状。但本次实验中是按照采样速率和符号率定义的，按定义映射到`sps = Fd/Fs`（采样速率/符号率=每个符号的样本数，亦即上采样因子），`span = N`（所采样的符号总数）。经测试也可生成类似的眼图，但是两函数关于原点处的幅值定义不同：rcosine函数是按原点处幅值为1设计的，而rcosdesign函数是按整个滤波器能量为1设计的，所以导致实验中原点处幅值仅0.14左右，生成了如下图所示的眼图：

<img src="E:\2022春课程资料\现代通信原理\实验三\eye_special.png" alt="eye_special" style="zoom: 50%;" />

可以看到最大信号处幅值只有0.14左右。按照这种方法，若在后面继续加入噪声、码间串扰等，会发现眼图变得很混乱，眼图的张开程度很小，并不方便观察。所以本次实验主体还是采用rcosine函数设计。进一步查阅资料得知，采用matlab自带的 fdtool（filter design tool，滤波器设计工具箱）也可以做到升余弦滤波器的设计。设计界面如下：

<img src="E:\2022春课程资料\现代通信原理\实验三\fdtool.png" alt="fdtool" style="zoom: 50%;" />

 设计完成后选择导出滤波器系数，在上述代码中替换掉对应的`H`也可以生成对应的眼图。总之，这次实验让我进一步感受到了matlab在信号分析与处理之中的强大之处，也让我对数字信号的通信过程与处理方法有了更进一步的理解。
