# 2021秋数字信号处理第三次实验报告——**滤波器设计与滤波器特性分析**

​																																	PB19071509  王瑞哲

### 一、实验目的

1. 掌握 Matlab 下滤波器设计工具（fdatool）的使用方法；
2. 掌握 IIR 滤波器设计方法与 FIR 滤波器设计方法；
3. 了解 IIR 滤波器设计与 FIR 滤波器设计方法的差异；
4.  掌握滤波器特性分析的方法；
5. 了解Matlab中sptool工具的使用方法。



### 二、实验原理

​		数字滤波器有很多种，根据其实现的网络结构或者其冲激响应函数的时域特性，可分为两种：**有限冲激响应**( **FIR**，Finite Impulse Response)滤波器和**无限冲激响应**( **IIR**，Infinite Impulse Response)滤波器。

​		IIR滤波器和FIR滤波器的设计方法不同。**IIR**滤波器设计方法有间接法和直接法，间接法是借助于模拟滤波器的设计方法进行的。其设计步骤是：先设计过渡模拟滤波器得到系统函数H(s)，然后将H(s)按某种方法转换成数字滤波器的系统函数H(z)。在设计IIR滤波器时可以借助成熟的模拟滤波器的成果，如巴特沃斯、契比雪夫和椭圆滤波器等，根据指标先写出模拟滤波器的公式，然后通过一定的变换，将模拟滤波器的公式转换成数字滤波器的公式。

​		**FIR**滤波器必须采用间接法，常用的方法有窗函数法、频率采样法和切比雪夫等波纹逼近法。对于线性相位滤波器，经常采用FIR滤波器。在设计FIR滤波器时可以根据对阻带衰减及过渡带的指标要求，选择窗函数类型（矩形窗、三角窗、汉宁窗、汉明窗、凯塞窗等），并估计窗口长度N，先按照阻带衰减选择窗函数类型。保证阻带衰减满足要求的情况下，尽量选择主瓣的窗函数，再构造希望逼近的频率响应函数，计算h(n)。最后加窗便可以得到设计结果。

​		本次实验借助Matlab中的**fdatool**工具箱（现版本用filter designer替换）实现各项滤波器实现指标，同时利用**sptool**工具箱对信号进行处理和分析。Filter Designer的操作界面如下图所示：

<img src="E:\2021秋课程资料\数字信号处理\第三次实验\filter designer界面.png" alt="filter designer界面" style="zoom: 50%;" />



### 三、实验内容

#### 1）IIR滤波器设计

```plaintxt
备注：实验报告要求中的第1条在此部分给出：记录在上机实验内容中所设计的IIR滤波器的传递函数H(z)及对应的幅频特性曲线，定性分析它们的性能，判断设计是否满足需求
```

1. ##### 采样频率为1Hz，设计一个Chebyshev高通数字滤波器，其中通带临界频率 fp = 0.3Hz ，通带内衰减小于 0.8dB （ $\alpha_p$= 0.8dB ），阻带临界频率 fs = 0.2Hz ，阻带内衰减大于20dB （ $\alpha_s$ = 20dB ）。求这个数字滤波器的传递函数 H(z)，输出它的幅频特性曲线，观察其通带衰减和阻带衰减是否满足要求。

   如下图，调用Matlab中的滤波器设计工具fdatool，设定参数如下图：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-1-1参数.png" alt="3-1-1参数" style="zoom:67%;" />

   所设计出的滤波器幅频特性为：

   ![3-1-1幅频响应](E:\2021秋课程资料\数字信号处理\第三次实验\3-1-1幅频响应.png)

   由幅频响应图像可知，频率为200mHz（即**阻带**临界频率0.2Hz）处的幅频增益为-30dB<-20dB，频率为300mHz（即**通带**临界频率0.3Hz）处的幅频增益为-0.78dB>-0.8dB，符合设计需求。

   fdatool工具箱所给出的该滤波器实现结构为直接II型的四阶（N=4）滤波器。根据fdatool工具箱所给出的滤波器系数，可以写出该滤波器的系统函数为：
   $$
   H(z)=\frac{0.0262z^4-0.1047z^3+0.1570z^2-0.1047z+0.0262}{z^4+1.5289z^3+1.6537z^2+0.9452z+0.2796}
   $$
   可见滤波器阶数为$N=4$。其中fdatool查看滤波器系统函数的系数界面截图如下所示：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-1-1系数.png" alt="3-1-1系数" style="zoom: 67%;" />

   

2. **采样频率为 1Hz，设计一个数字低通滤波器，要求其通带临界频率 fp = 0.2Hz ，通带内衰减小于 1dB （ $\alpha_p$ = 1dB )，阻带临界频率 fs = 0.3Hz ，阻带内衰减大于 25dB（ $\alpha_s$= 25dB ）。求这个数字滤波器的传递函数 H(z)，输出它的幅频特性曲线。**

   与1相似，调用fdatool工具，按给定的参数设置滤波器参数。由于并没有指定滤波器种类，不妨采用Chebyshev II型滤波器进行设计。最终给出的系统函数为：
   $$
   H(z)=\frac{0.1353z^4+0.3342z^3+0.4461z^2+0.3342z+0.1353}{z^4-0.2230z^3+0.5857z^2-0.0094z+0.0317}
   $$
   可见滤波器阶数为$N=4$。所设计出的滤波器幅频特性为：

   ![3-1-2幅频响应](E:\2021秋课程资料\数字信号处理\第三次实验\3-1-2幅频响应.png)

   由幅频响应图像可知，频率为200mHz（即**通带**临界频率0.2Hz）处的幅频增益约为-0.99dB>-1dB，频率为300mHz（即**阻带**临界频率0.3Hz）处的幅频增益约为-31dB<-30dB，符合设计需求。

   

3. **设计 Butterworth 带通数字滤波器，其上下边带 1dB 处的通带临界频率分别为 20kHz 和 30kHz（ fp1 = 20kHz， fp2 = 30kHz，$\alpha_p$ = 1dB ），当频率低于 15kHz 时，衰减要大于 40dB（ fs = 15kHz，$\alpha_s$ = 40dB ），采样周期为 10μs，求这个数字滤波器的传递函数 H(z)，输出它的幅频特性曲线，观察其通带衰减和阻带衰减是否满足要求。**

   与1相似，调用fdatool工具，按给定的参数设置滤波器参数。最终给出的系统函数为：
   $$
   H(z)=\frac{0.000154z^{14}-0.001078z^{12}+0.0032z^{10}-0.0054z^8+0.0054z^6-0.0032z^4+0.001078z^2-0.000154}{z^{14}+3.9190z^{12}+7.0109z^{10}+7.2789z^8+4.6942z^6+1.8690z^4+0.4236z^2+0.0420}
   $$
   可见滤波器阶数为$N=14$。所设计出的滤波器幅频特性为：
   
   ![3-1-3幅频响应](E:\2021秋课程资料\数字信号处理\第三次实验\3-1-3幅频响应.png)
   
   由幅频响应图像可知，频率在**通带**临界频率20kHz 和 30kHz处的幅频增益约为-0.96dB>-1dB，频率在**阻带**临界频率15kHz处的幅频增益约为-43dB<-40dB，符合设计需求。
   
   

#### 2）FIR滤波器设计

```
备注：实验报告要求中的第2条在此部分给出：记录在实验过程中FIR滤波器设计结果的h(n)的幅频和相位特性曲线，比较它们的性能，说明滤波器N和窗函数对滤波器性能的影响。
```

1. **用 Hanning 窗设计一个线性相位带通滤波器，其长度 N=15，上下边带截止频率分别为 w1= 0.3$\pi$ ， w2 = 0.5$\pi$ ，求 h(n)，绘制它的幅频和相位特性曲线，观察它的实际 3dB 和 20dB 带宽。如果 N=45，重复这一设计，观察幅频和相位特性的变化，注意长度N变化对结果的影响。**

   此时调用Matlab的参数设置界面为：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-1-1参数.png" alt="3-2-1-1参数" style="zoom:67%;" />

   注意此处滤波器阶数需指定为15-1=14，因为Hanning窗序列长度N=15中还包含n=0的点，因此滤波器阶数需要减一。设计出的滤波器单位脉冲响应$h(n)$的序列图为：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-1-1单位脉冲响应.png" alt="3-2-1-1单位脉冲响应" style="zoom:67%;" />

   其中15个序列值分别给出为：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-1-1系数.png" alt="3-2-1-1系数" style="zoom:67%;" />

   它的幅频和相位特性曲线为：

   ![3-2-1-1幅频响应和相频响应](E:\2021秋课程资料\数字信号处理\第三次实验\3-2-1-1幅频响应和相频响应.png)

   由幅频特性曲线可知，实际的3dB带宽约为$0.5115\pi-0.2888\pi=0.22\pi$（比设定的通带带宽$0.2\pi$略宽），实际的20dB带宽约为$0.6620\pi-0.1365\pi=0.53\pi$.

   若修改$N=45$，则幅频和相位特性曲线变为：

   ![3-2-1-2幅频和相频响应](E:\2021秋课程资料\数字信号处理\第三次实验\3-2-1-2幅频和相频响应.png)

   由幅频特性曲线可知，实际的3dB带宽约为$0.4797\pi-0.3203\pi=0.16\pi$（未到达所设定的通带带宽$0.2\pi$），实际的20dB带宽约为$0.5439\pi-0.2561\pi=0.29\pi$（比N=15的情况大幅降低）。

   对比二者可以发现，**增加长度N，可以有效减小过渡带宽度，使滤波器的幅频特性曲线更接近理想滤波器**，或说使过渡带更加陡峭，这从上面所计算的实际3dB和20dB带宽的变化也可以看出；**但增加长度N并不能改变肩峰（过冲）的幅度大小，只能使起伏振荡变密，这种现象称为吉布斯（Gibbs）效应**。肩峰值大小直接决定着通带内的平稳和阻带的衰减，对滤波器的性能影响很大。如果想要改善阻带的衰减特性，只改变N是无能为力的，只能从改善窗函数的形状上找出路。

   

2. **改用矩形窗和 Blackman 窗，设计步骤（1）中的带通滤波器，观察并记录窗函数对滤波器幅频和相位特性的影响，比较这三种窗函数的特点。**

   当$N=15$时，改用矩形窗：

   ![3-2-2-1幅频特性](E:\2021秋课程资料\数字信号处理\第三次实验\3-2-2-1幅频特性.png)

   改用Blackman窗：

   ![3-2-2-3幅频特性](E:\2021秋课程资料\数字信号处理\第三次实验\3-2-2-3幅频特性.png)

   当$N=45$时，改用矩形窗：

   ![3-2-2-2幅频特性](E:\2021秋课程资料\数字信号处理\第三次实验\3-2-2-2幅频特性.png)

   改用Blackman窗：

   ![3-2-2-4幅频特性](E:\2021秋课程资料\数字信号处理\第三次实验\3-2-2-4幅频特性.png)

   对比在N相同时各窗函数的幅频和相位特性，可得出结论：各窗函数的**主瓣宽度、旁瓣电平、通带起伏**会影响到设计出滤波器的**通带宽度、阻带衰减和通带波动**。三种窗函数的性能对比如下表所示：

   |   窗函数   | 主瓣宽度  | 旁瓣电平/dB | 阻带衰减/dB | 通带起伏/dB |
   | :--------: | :-------: | :---------: | :---------: | :---------: |
   |   矩形窗   | $4\pi/N$  |     -13     |     -21     |     0.7     |
   | Hanning窗  | $8\pi/N$  |     -32     |     -44     |    0.05     |
   | Blackman窗 | $12\pi/N$ |     -57     |     -74     |    0.002    |

   从上面所展示的各幅频曲线也可以看出，在N相同时，**矩形窗的过渡带宽度最小**，Hanning窗次之，Blackman窗最大；**矩形窗的阻带衰减最小**，Hanning窗次之，Blackman窗最大。

   

3. **用 Kaiser 窗设计一个专用的线性相位滤波器。 N=40，理想的幅频特性如下图所示：**

   ![Kaiser窗](E:\2021秋课程资料\数字信号处理\第三次实验\Kaiser窗.png)

   **当 beta 值分别 4,6,8 时，设计相应的滤波器，比较它们的幅频和相位特性，观察并分析 beta 值不同的时候对结果有什么影响。**

   考虑到该理想幅频特性为一个双带通的滤波器，考虑使用一个$[0.2\pi,0.4\pi]$的带通滤波器和一个$[0.6\pi,0.8\pi]$的带通滤波器**并联而成**。对于单位脉冲响应而言，**两滤波器的并联在单位脉冲响应上即是相加操作，即有总响应为$h(n)=h_1(n)+h_2(n)$。**例如当$\beta=4$时，分别设计两带通滤波器为：
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-3滤波器1.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-3滤波器2.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>[0.2π,0.4π]的带通滤波器</center></td>
       <td><center>[0.6π,0.8π]的带通滤波器</center></td>
       </tr>
   </table>
   
   利用 fdatool 中的”导出“——”系数“功能，**将所设计的$[0.2\pi,0.4\pi]$带通滤波器和$[0.6\pi,0.8\pi]$带通滤波器系数分别导出到Matlab工作区再相加，利用freqz函数查看总单位脉冲响应的幅频和相位特性**。给出matlab实现代码为：
   
   ```matlab
   figure('name','β=4'); freqz( Num1_1 + Num1_2 );
   figure('name','β=6'); freqz( Num2_1 + Num2_2 );
   figure('name','β=8'); freqz( Num3_1 + Num3_2 );
   ```
   
   最终输出的各幅频和相位特性曲线如下图所示：
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-3-1.png"		
                        alt="第一张图片显示不出时显示的文字"
                        height="填数字作为高度"/></center></td><!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-3-2.png"
                        alt="第二张图片显示不出时显示的文字"
                        height="高度一致会好看"/></center></td>
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-2-3-3.png"
                        alt="第二张图片显示不出时显示的文字"
                        height="高度一致会好看"/></center></td>
       </tr>
       <td><center>β=4</center></td>
       <td><center>β=6</center></td>
       <td><center>β=8</center></td>
   	<tr>
   </table>
   
   由图像可见，对于Kaiser窗而言，其β值会影响滤波器的旁瓣特性——随着 β 的增加，相对旁瓣衰减降低，主瓣宽度增加。而由于上述滤波器采用两带通滤波器并联的形式，在β值较大时，主瓣宽度过大会导致中间阻带$[0.4\pi,0.6\pi]$的幅频特性发生一部分重叠。
   
   

#### 3）滤波器特性分析

```
备注：实验报告要求中的第3条在此部分给出：记录滤波器特性分析中滤波器特性比较的结论并进行解释。
```

**针对IIR滤波器设计实验内容中的三款滤波器（低通、高通和带通），采用基于blackman窗函数的FIR设计方法重新设计，比较用IIR与FIR方法得到的滤波器的幅频特性、相频特性、零极点、群延时、相位延时。对比较的结论进行原理性解释。**

1. **FIR重新设计高通滤波器**——通带临界频率 fp = 0.6$\pi$ ，通带内衰减 $\alpha_p$= 0.8dB ，阻带临界频率 fs = 0.4$\pi$ ，阻带内衰减 $\alpha_s$ = 20dB [已将采样频率1Hz归一化为2$\pi$]

   **因为FIR窗函数设计中已经固定截止频率处的衰减固定为6dB，且并不能选择阻带内衰减，所以只能将截止频率$\omega_c$设置得比通带临界频率更小**（如此处设为$\omega_c=0.5\pi$，并不断调整滤波器阶数，以使得通带和阻带内衰减满足设计要求。最终选定当阶数为25时可以达到设计要求。

   比较FIR、IIR滤波器的各项性能如下：

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 FIR 幅频.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 IIR 幅频.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器幅频响应</center></td>
       <td><center>IIR滤波器幅频响应</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 FIR 相频.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 IIR 相频.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器相频响应</center></td>
       <td><center>IIR滤波器相频响应</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 FIR 零极点.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 IIR 零极点.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器零极点图</center></td>
       <td><center>IIR滤波器零极点图</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 FIR 群延迟.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 IIR 群延迟.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器群延迟</center></td>
       <td><center>IIR滤波器群延迟</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 FIR 相位延迟.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-1 IIR 相位延迟.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器相位延迟</center></td>
       <td><center>IIR滤波器相位延迟</center></td>
       </tr>
   </table>
   

2. **FIR重新设计低通滤波器**——通带临界频率 fp = $0.4\pi$ ，通带内衰减 $\alpha_p$ = 1dB ，阻带临界频率 fs = $0.6\pi$，阻带内衰减 $\alpha_s$= 25dB 

   与1同理，只能将截止频率设为比通带截止频率更大的$\omega_c=0.5\pi$，并不断调整滤波器阶数，以使得通带和阻带内衰减满足设计要求。最终选定当阶数为29时可以达到设计要求。

   比较FIR、IIR滤波器的各项性能如下：

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 FIR 幅频.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 IIR 幅频.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器幅频响应</center></td>
       <td><center>IIR滤波器幅频响应</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 FIR 相频.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 IIR 相频.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器相频响应</center></td>
       <td><center>IIR滤波器相频响应</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 FIR 零极点.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 IIR 零极点.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器零极点图</center></td>
       <td><center>IIR滤波器零极点图</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 FIR 群延迟.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 IIR 群延迟.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器群延迟</center></td>
       <td><center>IIR滤波器群延迟</center></td>
       </tr>
   </table>

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 FIR 相位延迟.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-2 IIR 相位延迟.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器相位延迟</center></td>
       <td><center>IIR滤波器相位延迟</center></td>
       </tr>
   </table>
   
   
3. **FIR重新设计带通滤波器**——通带临界频率 fp1 = 20kHz/0.4$\pi$， fp2 = 30kHz/0.6$\pi$，通带衰减$\alpha_p$ = 1dB ，阻带临界频率 fs = 15kHz/0.3$\pi$，阻带衰减$\alpha_s$ = 40dB [已将采样频率100kHz归一化为2$\pi$]

   与1同理，只能将FIR滤波器的通带范围由 $[\omega_{p1}=0.4\pi,\omega_{p2}=0.6\pi]$ 扩大至$[\omega_{c1}=0.36\pi,\omega_{pc2}=0.64\pi]$，并不断调整滤波器阶数，以使得通带和阻带内衰减满足设计要求。最终选定当阶数为69时可以达到设计要求。该阶数的选定非常艰难，因为所扩展的$\omega_{c1}$和$\omega_{c2}$也需要进行调整，如果$\omega_{c1}$到$\omega_{c2}$范围大了可能会发生通带衰减已远满足要求，但阻带衰减远没达到要求；范围小了则会倒过来，阻带到达要求而通带没有。从下面的幅值响应图也能看出，在这样$\omega_{c1}$到$\omega_{c2}$的范围仍偏大，阻带衰减刚好到达要求，但通带衰减仍有一定的裕量。

   比较FIR、IIR滤波器的各项性能如下：
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 FIR 幅频.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 IIR 幅频.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器幅频响应</center></td>
       <td><center>IIR滤波器幅频响应</center></td>
       </tr>
   </table>
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 FIR 相频.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 IIR 相频.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器相频响应</center></td>
       <td><center>IIR滤波器相频响应</center></td>
       </tr>
   </table>
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 FIR 零极点.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 IIR 零极点.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器零极点图</center></td>
       <td><center>IIR滤波器零极点图</center></td>
       </tr>
   </table>
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 FIR 群延迟.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 IIR 群延迟.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器群延迟</center></td>
       <td><center>IIR滤波器群延迟</center></td>
       </tr>
   </table>
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 FIR 相位延迟.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-3-3 IIR 相位延迟.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>FIR滤波器相位延迟</center></td>
       <td><center>IIR滤波器相位延迟</center></td>
       </tr>
   </table>
   
   
   
   对比上述FIR和IIR滤波器，结合FIR滤波器和IIR滤波器设计原理，可以发现：
   
   - **幅频特性上**，IIR滤波器的幅频响应优于FIR滤波器。IIR滤波器幅频响应形状取决于所设计的类型，如Butterworth型、Chebyshev型等；FIR滤波器幅频响应形状取决于所采用的窗函数，直接体现为阻带处的纹波振荡。当滤波器阶数N越高时，FIR滤波器阻带振荡次数也就越多。**对于相同的滤波器指标设计要求，IIR滤波器所要求的滤波器阶数远远小于FIR滤波器**；
   - **相频特性上**，IIR滤波器优异的幅度响应是以非线性的相位响应为代价的，而非线性相位会引起频率色散。而FIR滤波器具有严格的线性相位特性，这一点从FIR滤波器的相频响应中也可以看出，其中锯齿状折线是由于其频率响应符号发生变化所附加的相位$\pi$；
   - **零极点分布上**，FIR滤波器具有N-1个可位于有限z平面任何位置的零点和N-1个位于原点位置的极点，而IIR滤波器具有N个位于单位圆内的零点和极点。因为IIR滤波器对零极点的约束较少，因此可用较低的阶数获得高的选择性，所用的存储单元少，计算量小，效率高。FIR滤波器传递函数的极点固定在原点，所以只能靠改变零点位置来改变它的性能。所以要达到高的选择性，必须用较高的阶数。
   - **群延迟和相位延迟上**，FIR滤波器具有线性相位特性，故其群延迟和相位延迟为常数，且可以证明$\alpha=\frac{N-1}{2}$；IIR滤波器不具有线性相位特性，因而其群延迟和相位延迟也是非线性的。
   
   

#### 4）滤波器的实际应用

1. **用Matlab产生信号$x(t)=0.5+1.2sin(2πf_1t)+0.5cos(2πf_2t)+ω(t)$，其中$f_1$=50Hz，$f_2$=200Hz，ω(t)为高斯白噪声，采样频率$f_s$=1000Hz。利用sptool工具导入该信号，并观察其频谱特性。**

   利用matlab产生信号的代码如下：

   ```matlab
   f1=50;f2=200;fs=1000;
   n=1:1024;   % 取1024点
   x=0.5+1.2*sin(2*pi*f1*n/fs)+0.5*cos(2*pi*f2*n/fs);
   x=x+awgn(x,10,'measured');      
   %在信号中加入高斯白噪声。参数10为信噪比SNR,单位dB;参数'measured'表示在添加噪声之前测量x的能量
   ```

   利用sptool工具导入该信号，导入界面如下：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-4-0sptool导入数据.png" alt="3-4-0sptool导入数据" style="zoom:67%;" />

   导入后可观察到该信号的时域特性为：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-4-0sptool查看时域波形.png" alt="3-4-0sptool查看时域波形" style="zoom: 50%;" />

   其频域特性为：

   <img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-4-0sptool查看频域波形.png" alt="3-4-0sptool查看频域波形" style="zoom: 67%;" />

   可见在直流点和引入的两正弦频率点f=50Hz和f=200Hz处有三个峰值，其余频率处的杂波由所引入的高斯白噪声所导致。

   

2. **在sptool中调用fdatool工具，设计一个butterworth低通滤波器，通带边界频率为100Hz，阻带边界频率为150Hz，通带波纹不大于2dB，阻带衰减不小于50dB，观察所设计滤波器的幅频特性、相频特性、零极点、群延时和脉冲响应。**

   所设计滤波器的幅频特性为：

   ![3-4-1幅频特性和相频特性](E:\2021秋课程资料\数字信号处理\第三次实验\3-4-1幅频特性和相频特性.png)

   其零极点分布图、群延时和脉冲响应分别为：

   ![3-4-1零极点图](E:\2021秋课程资料\数字信号处理\第三次实验\3-4-1零极点图.png)

   ![3-4-1脉冲响应](E:\2021秋课程资料\数字信号处理\第三次实验\3-4-1脉冲响应.png)

   ![3-4-1群延迟](E:\2021秋课程资料\数字信号处理\第三次实验\3-4-1群延迟.png)

   

3. **在sptool中用（2）中设计的滤波器对（1）中的信号进行滤波处理，并分析滤波前后信号的频谱变化。**

   调用sptool工具，选中待处理的x信号和（2）中所设计的滤波器，点击“应用”进行信号处理，得到滤波前后的频谱对比如下图所示：

   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-4-0sptool查看频域波形.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-4-1滤波后频域波形.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>滤波前频谱</center></td>
       <td><center>滤波后频谱</center></td>
       </tr>
   </table>

   可以观察到，在频率大于150Hz部分的频谱分量几乎被完全滤除，符合预期结果。

   

4. **在sptool中调用fdatool工具，用Kaiser窗设计一个能滤除（1）中信号x(t)的直流分量和f1频率分量的滤波器，观察滤波前后的频谱变化。**

   根据设计要求，该滤波器需要滤除0Hz（即直流分量）、50Hz、和高频白噪声部分成分，保留200Hz频率分量，因此可考虑利用Kaiser窗设计一个带通滤波器。通带定为[180Hz，200Hz]，取定β=4，阶数为80，调用sptool的fdatool工具设计滤波器界面为：
   
   ![3-4-2滤波器设计界面](E:\2021秋课程资料\数字信号处理\第三次实验\3-4-2滤波器设计界面.png)
   
   调用sptool工具，选中待处理的x信号和上面所设计的滤波器，点击“应用”进行信号处理，得到滤波前后的频谱对比如下图所示：
   
   <table frame=void>	<!--使用table标签，且frame=void消除外边框-->
   	<tr>		   <!--<tr>一行的内容<\tr>，<td>一个格子的内容<\td>-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-4-0sptool查看频域波形.png"		
                        alt="错误"
   					 /></center></td>	<!--<center>标签将图片居中-->
       <td><center><img src="E:\2021秋课程资料\数字信号处理\第三次实验\3-4-2滤波后频域波形.png"
                        alt="错误"
                        /></center></td>
       <tr>
       <td><center>滤波前频谱</center></td>
       <td><center>滤波后频谱</center></td>
       </tr>
   </table>
   
   可以观察到，在直流成分、低频f1=50Hz成分和高频白噪声成分的频谱分量被较好地滤除，符合预期结果。



### 四、分析总结

1、 记录在上机实验内容中所设计的IIR滤波器的传递函数$H(z)$及对应的幅频特性曲线，定性分析它们的性能，判断设计是否满足需求。

2、 记录在实验过程中FIR滤波器设计结果的$h(n)$的幅频和相位特性曲线，比较它们的性能，说明滤波器N和窗函数对滤波器性能的影响。

3、 记录滤波器特性分析中滤波器特性比较的结论并进行解释。

（1、2、3点已在第三部分实验内容中完成）

**4、 对IIR滤波器设计和FIR滤波器设计的优缺点进行总结。**

- **IIR滤波器系统函数的极点可以位于单位圆内任何地方，因此可用较低的阶数获得高选择性**，所用存储单元少，经济且效率高。**但这是以相位的非线性为代价的**。选择性越好，则相位的非线性越严重。相反，**FIR滤波器却可以得到严格的线性相位，然而由于FIR滤波器系统函数的极点固定在原点，所以只能用较高的阶数达到高选择性**，对于同样的滤波器设计指标，FIR所要求的阶数可以比IIR滤波器高5~10倍，导致成本较高，信号延时也较大。如果按相同的选择性和相同的线性相位要求来说，则IIR滤波器就必须加全通网络进行相位校正，同样要大大增加滤波器的节数和复杂性；
- **FIR滤波器可以用非递归方式来实现，有限精度的计算不会产生振荡**。同时由于量化舍入以及系数的不准确所引起的误差的影响比IIR滤波器要小得多。显然**对IIR滤波器必须留心稳定性问题**，注意极点是否会位于单位圆之外，另外有限字长效应有时会引起寄生振荡。再者**FIR滤波器可采用FFT算法**，在相同阶数下，运算速度可以快得多；
- **IIR滤波器可以借助于模拟滤波器的成果**，一般都有有效的封闭形式设计公式可供准确计算，**计算工作量比较小**，对计算工具要求不高。**FIR滤波器没有现成设计公式**。窗函数法仅可以给出窗函数的计算公式，但计算通、阻带衰减仍无显式表达式。其他大多数设计FIR滤波器的方法都需要借助计算机辅助设计；
- IIR滤波器设计法，主要是设计规格化的，频率特性为分段常数的滤波器，而**FIR滤波器则易于适应某些特殊应用**，如构成微分器或积分器，或用于巴特沃斯、切比雪夫等逼近不可能达到预定指标的情况，例如由于某些原因要求三角形振幅响应。

**5、总结实验中根据实验现象得到的其他个人结论。**

- 通过本次实验，我对于IIR和FIR滤波器的设计原理有了进一步的认识，同时掌握了matlab环境下滤波器设计工具fdatool和信号处理与分析工具sptool的使用技巧。在理论学习FIR和IIR滤波器设计方法的同时，借助本次实验我也体会到了计算机辅助设计滤波器的便捷与快速。

- 值得注意的是，理论知识在介绍关于线性相位滤波器时曾提及，若要限制滤波器的相位特性是线性的，则需要限制其单位脉冲响应满足：$h(n)=\pm h(N-1-n)$，其中正负号分别对应偶对称和奇对称的情况。当h(n)特性不同，以及单位脉冲响应长度N不同时，对滤波器的幅频特性有如下限制：

  | $h(n)$ | $N$  |      对滤波器类型的限制      |
  | :----: | :--: | :--------------------------: |
  | 偶对称 | 奇数 |           没有限制           |
  | 偶对称 | 偶数 | 不能用于逼近高通和带阻滤波器 |
  | 奇对称 | 奇数 |    只能用于逼近带通滤波器    |
  | 奇对称 | 偶数 | 不能用于逼近低通和带阻滤波器 |

  在本次实验设计FIR滤波器的内容中，通过fdatool可以观察到各滤波器的单位脉冲响应h(n)特性。通过观察发现它们都满足$h(n)=\pm h(N-1-n)$，即滤波器确实是线性相位的。进而可观察它们是奇对称还是偶对称的，结合N的奇偶性进行验证，发现所设计出的所有滤波器均满足上表格对于滤波器类型的限制。这也体现出，实际设计必须要满足理论推导所导出的限制条件，才说明设计是合理可行的。